#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
PROJECT_ROOT="$(cd "$SCRIPT_DIR/.." && pwd)"

source "$PROJECT_ROOT/config/toolkit.conf"
source "$PROJECT_ROOT/utils/logger.sh"

mkdir -p "$(dirname "$REPORT_FILE")"

cat > "$REPORT_FILE" <<EOF
<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>SentinelShell Daily Report</title>

<style>
body {
    font-family: Arial, sans-serif;
    background: #f4f6f8;
    padding: 20px;
}
h1 {
    color: #222;
}
.section {
    background: #fff;
    padding: 15px;
    margin-bottom: 20px;
    border-radius: 6px;
    box-shadow: 0 0 6px rgba(0,0,0,0.08);
}
.section h2 {
    border-left: 4px solid #007bff;
    padding-left: 10px;
    color: #007bff;
}
.ok {
    color: green;
    font-weight: bold;
}
.warn {
    color: orange;
    font-weight: bold;
}
.alert {
    color: red;
    font-weight: bold;
}
pre {
    background: #f1f1f1;
    padding: 10px;
    overflow-x: auto;
    border-radius: 4px;
}
footer {
    text-align: center;
    font-size: 12px;
    color: #777;
}
</style>
</head>

<body>

<h1>ğŸ›¡ SentinelShell Daily Report</h1>
<p><strong>Host:</strong> $(hostname)</p>
<p><strong>Date:</strong> $(date)</p>

<div class="section">
<h2>ğŸ“Š System Health</h2>
<pre>
$(uptime)
$(df -h /)
</pre>
</div>

<div class="section">
<h2>ğŸ“¦ Service Status</h2>
<pre>
$(for s in $SERVICES; do
    systemctl is-active $s 2>/dev/null | sed "s/^/$s : /"
done)
</pre>
</div>

<div class="section">
<h2>ğŸ” SSH Brute Force Attempts</h2>
<pre>
$(cat "$PROJECT_ROOT/reports/ssh_bruteforce.txt" 2>/dev/null || echo "No suspicious activity")
</pre>
</div>

<div class="section">
<h2>ğŸš« Permission Violations</h2>
<pre>
$(cat "$PROJECT_ROOT/reports/permission_violations.txt" 2>/dev/null || echo "No violations detected")
</pre>
</div>

<div class="section">
<h2>ğŸ’¾ Backup Summary</h2>
<pre>
$(ls -lh "$BACKUP_DIR" | tail -n 5)
</pre>
</div>

<div class="section">
<h2>ğŸ“œ Recent Logs</h2>
<pre>
$(tail -n 20 "$LOG_FILE")
</pre>
</div>

<footer>
Generated by SentinelShell â€¢ Automated Linux Monitoring Toolkit
</footer>

</body>
</html>
EOF

log "HTML report generated at $REPORT_FILE"
